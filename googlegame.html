<!DOCTYPE html>
<html lang="vi">
<head>
    <meta name="theme-color" content="#313131">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embedded Google Solitaire | Solitaire Hub 2026</title>
    
    <link rel="icon" href="icon.png" type="image/png">
    <link rel="manifest" href="manifest.json">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Flex:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @font-face {
            font-family: 'Minecraft';
            src: url('https://tuanphong3108.github.io/google-sans-do-not-access/minecraft.ttf') format('truetype');
            font-weight: normal; 
            font-style: normal;
        }

        :root {
            --md-sys-color-surface: #1a1c1e;
            --md-sys-color-on-surface: #e2e2e6;
            --md-sys-color-primary: #a0ccff;
            --md-sys-color-error: #ffb4ab;
            --md-sys-color-surface-container: #1e1f21;
        }

        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden;
            font-family: 'Google Sans Flex', sans-serif;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
        }

        .mc-font {
            font-family: 'Minecraft', monospace;
            letter-spacing: 1px;
        }

        #game-iframe {
            width: 100%;
            height: 100%;
            border: none;
            transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
        }

        /* Loading Screen MD3 Expressive */
        #loading-screen {
            position: fixed;
            inset: 0;
            background: var(--md-sys-color-surface);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s;
        }

        #loading-indicator {
            width: 100px;
            height: auto;
            filter: grayscale(100%) brightness(1.5) sepia(100%) hue-rotate(170deg) saturate(150%);
            margin-bottom: 24px;
        }

        /* Home Button */
        .btn-home {
            background-color: #313131;
            color: white;
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-home:hover {
            background-color: #444;
            transform: scale(1.1) rotate(-5deg);
        }

        .btn-home .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            transition: font-variation-settings 0.3s;
        }

        .btn-home:hover .material-symbols-outlined {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        /* Modal Expressive */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-content {
            background: var(--md-sys-color-surface-container);
            border-radius: 32px;
            border: 1px solid rgba(160, 204, 255, 0.1);
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal-active {
            display: flex;
            opacity: 1;
        }

        .modal-active .modal-content {
            transform: scale(1);
        }

        /* Progress Bar */
        .progress-container {
            width: 200px;
            height: 4px;
            background: rgba(160, 204, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 16px;
        }
        .progress-bar {
            height: 100%;
            background: var(--md-sys-color-primary);
            width: 0%;
            transition: width 2s ease-in-out;
        }
    </style>
</head>
<body>

    <!-- MD3 Loading Screen -->
    <div id="loading-screen">
        <img id="loading-indicator" src="https://tuanphong3108.github.io/md3-loading/Loading_Indicator.gif" alt="Loading">
        <p class="mc-font text-[10px] tracking-[4px] uppercase opacity-60">Connecting to Google</p>
        <div class="progress-container">
            <div id="pb" class="progress-bar"></div>
        </div>
    </div>

    <!-- Game Container -->
    <div id="embed-container" class="relative w-full h-full flex flex-col">
        <iframe id="game-iframe" 
                src="https://www.google.com/logos/fnbx/solitaire/standalone.html?hl=vi" 
                allowfullscreen 
                title="Google Solitaire"></iframe>

        <!-- Controls -->
        <div class="fixed top-6 right-6 z-50">
            <button onclick="toggleModal(true)" class="btn-home group">
                <span class="material-symbols-outlined text-2xl">home</span>
            </button>
        </div>
    </div>

    <!-- Exit Confirmation Modal -->
    <div id="exit-modal" class="modal-backdrop fixed inset-0 z-[100] items-center justify-center p-6">
        <div class="modal-content p-8 max-w-sm w-full shadow-2xl">
            <div class="flex flex-col items-center text-center">
                <div class="bg-red-900/20 p-4 rounded-2xl mb-4">
                    <span class="material-symbols-outlined text-red-300 text-4xl">warning</span>
                </div>
                <h3 class="text-2xl font-black mb-2 mc-font uppercase text-[#a0ccff]">Thoát Game?</h3>
                <p class="text-gray-400 text-sm mb-8 leading-relaxed">Tiến trình chơi hiện tại của Phong sẽ không được lưu lại đâu nhé!</p>
                
                <div class="flex w-full gap-3">
                    <button onclick="toggleModal(false)" 
                            class="flex-1 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-white font-bold transition-all">
                        Ở lại
                    </button>
                    <button id="btn-confirm-exit" 
                            class="flex-1 py-3 rounded-xl bg-red-600 hover:bg-red-700 text-white font-bold transition-all shadow-lg shadow-red-900/20">
                        Thoát ngay
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const loadingScreen = document.getElementById('loading-screen');
        const progressBar = document.getElementById('pb');
        const gameIframe = document.getElementById('game-iframe');
        const exitModal = document.getElementById('exit-modal');
        const btnConfirmExit = document.getElementById('btn-confirm-exit');

        // Logic Chặn thoát nhầm (Reload/Close Tab)
        const preventUnload = (e) => {
            e.preventDefault();
            e.returnValue = ''; // Hiển thị hộp thoại mặc định của trình duyệt
        };

        // Kích hoạt lắng nghe sự kiện chặn thoát
        window.addEventListener('beforeunload', preventUnload);

        // Toggle Modal UI
        function toggleModal(show) {
            if (show) {
                exitModal.classList.add('modal-active');
                setTimeout(() => exitModal.style.opacity = '1', 10);
            } else {
                exitModal.style.opacity = '0';
                setTimeout(() => exitModal.classList.remove('modal-active'), 300);
            }
        }

        // Thoát về Hub qua nút bấm UI
        btnConfirmExit.onclick = function() {
            // QUAN TRỌNG: Gỡ bỏ sự kiện chặn thoát TRƯỚC khi chuyển hướng
            window.removeEventListener('beforeunload', preventUnload);
            window.location.href = 'https://tuanphong3108.github.io/solitaire/index.html';
        };

        // Logic Loading 2s Fixed
        window.onload = () => {
            setTimeout(() => progressBar.style.width = '100%', 100);

            setTimeout(() => {
                loadingScreen.style.opacity = '0';
                gameIframe.style.opacity = '1';
                setTimeout(() => {
                    loadingScreen.style.visibility = 'hidden';
                }, 500);
            }, 2000);
        };

        // Haptic Feedback
        document.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('click', () => {
                if ('vibrate' in navigator) navigator.vibrate(15);
            });
        });
    </script>
</body>
</html>
